# .github/workflows/release-library.yml
# 재사용 가능한 릴리즈 워크플로우
name: Release Native Library

on:
  workflow_call:
    inputs:
      release-version:
        description: '릴리즈 버전'
        required: true
        type: string
      release-title:
        description: '릴리즈 제목'
        required: true
        type: string
      release-notes:
        description: '릴리즈 노트'
        required: false
        type: string
        default: 'See CHANGELOG.md for details'
      draft:
        description: '드래프트 릴리즈로 표시할지 여부'
        required: false
        type: boolean
        default: false
      prerelease:
        description: '프리릴리즈로 표시할지 여부'
        required: false
        type: boolean
        default: false
    secrets:
      GITHUB_TOKEN:
        required: true

jobs:
  release:
    name: Create Release
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v3

      # 여러 플랫폼의 빌드 결과물 다운로드
      - name: Download Android artifacts
        uses: actions/download-artifact@v3
        with:
          name: android-library
          path: artifacts/android

      - name: Download iOS artifacts
        uses: actions/download-artifact@v3
        with:
          name: ios-library
          path: artifacts/ios

      - name: Download Windows artifacts
        uses: actions/download-artifact@v3
        with:
          name: windows-library
          path: artifacts/windows

      - name: Download macOS artifacts
        uses: actions/download-artifact@v3
        with:
          name: macos-library
          path: artifacts/macos

      - name: Download Linux artifacts
        uses: actions/download-artifact@v3
        with:
          name: linux-library
          path: artifacts/linux

      # 아티팩트 압축
      - name: Compress artifacts
        run: |
          cd artifacts
          zip -r android.zip android/
          zip -r ios.zip ios/
          zip -r windows.zip windows/
          zip -r macos.zip macos/
          zip -r linux.zip linux/

      # GitHub 릴리즈 생성
      - name: Create Release
        id: create_release
        uses: softprops/action-gh-release@v1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          tag_name: v${{ inputs.release-version }}
          name: ${{ inputs.release-title }}
          body: ${{ inputs.release-notes }}
          draft: ${{ inputs.draft }}
          prerelease: ${{ inputs.prerelease }}
          files: |
            artifacts/android.zip
            artifacts/ios.zip
            artifacts/windows.zip
            artifacts/macos.zip
            artifacts/linux.zip
